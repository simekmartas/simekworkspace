<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Bazar - Mobil Maják</title>
    <!-- Legacy Browser Support First -->
    <script src="legacy-browser-support.js"></script>
    <link rel="stylesheet" href="legacy-browser-styles.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#ff1493">
    
    <style>
        /* CSS styly pro date picker s rolovátky */
        .date-input-container {
            position: relative;
        }
        
        .date-toggle-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 2px 6px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 32px;
            width: 32px;
        }
        
        .date-toggle-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        .dark-theme .date-toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .date-selects {
            display: none;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: var(--secondary-color, #f8f9fa);
            border-radius: 8px;
            border: 1px solid var(--border-color, #e0e0e0);
        }
        
        .dark-theme .date-selects {
            background: rgba(30, 41, 59, 0.5);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .date-select {
            padding: 8px;
            border: 1px solid var(--border-color, #ccc);
            border-radius: 4px;
            background: var(--input-background, white);
            color: var(--text-primary, #333);
            font-size: 14px;
            font-family: inherit;
        }
        
        .date-select:focus {
            outline: none;
            border-color: var(--primary-color, #2196F3);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
        }
        
        .dark-theme .date-select {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(255, 255, 255, 0.2);
            color: #f8fafc;
        }
        
        .dark-theme .date-select:focus {
            border-color: var(--primary-color, #2196F3);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.3);
        }
        
        /* Responzivní design pro mobilní zařízení */
        @media (max-width: 768px) {
            .date-selects {
                grid-template-columns: 1fr;
                gap: 0.25rem;
            }
            
            .date-select {
                padding: 12px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
        
        /* Animace pro show/hide date selectů */
        .date-selects.show {
            display: grid;
            animation: slideDown 0.3s ease-in-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Styling pro date input když jsou aktivní rolovátka */
        .date-input-container.using-selects input {
            background-color: var(--disabled-background, #f5f5f5);
            color: var(--text-secondary, #666);
        }
        
        .dark-theme .date-input-container.using-selects input {
            background-color: rgba(30, 41, 59, 0.3);
            color: #94a3b8;
        }
        
        /* CSS styly pro animace úspěchu a chyby */
        .success-emoji, .error-emoji {
            position: fixed;
            font-size: 4rem;
            z-index: 10000;
            animation: bounceIn 0.6s ease-out;
            pointer-events: none;
        }
        
        .celebration-text, .error-text {
            position: fixed;
            top: 45%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            font-weight: bold;
            color: #2563eb;
            z-index: 10000;
            animation: slideInUp 0.8s ease-out;
            pointer-events: none;
            text-align: center;
        }
        
        .error-text {
            color: #dc2626;
        }
        
        @keyframes bounceIn {
            0% { transform: translateX(-50%) scale(0.3); opacity: 0; }
            50% { transform: translateX(-50%) scale(1.05); }
            70% { transform: translateX(-50%) scale(0.9); }
            100% { transform: translateX(-50%) scale(1); opacity: 1; }
        }
        
        @keyframes slideInUp {
            0% { transform: translateX(-50%) translateY(20px); opacity: 0; }
            100% { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        /* Konfety animace */
        .animation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
            animation: confettiFall linear infinite;
            border-radius: 50%;
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Sparkle animace */
        .sparkle {
            position: absolute;
            font-size: 1.5rem;
            animation: sparkleFloat 3s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes sparkleFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 1; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.5; }
        }
        
        /* Glow efekt pro úspěch */
        .form-success-glow {
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
            border: 2px solid #22c55e;
            animation: successGlow 2s ease-in-out;
        }
        
        @keyframes successGlow {
            0% { box-shadow: 0 0 30px rgba(34, 197, 94, 0.5); }
            50% { box-shadow: 0 0 60px rgba(34, 197, 94, 0.8); }
            100% { box-shadow: 0 0 30px rgba(34, 197, 94, 0.5); }
        }
        
        /* Shake efekt pro chybu */
        .form-error-shake {
            animation: errorShake 0.6s ease-in-out;
            border: 2px solid #ef4444;
        }
        
        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* Spinning animace pro loading tlačítko */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="protected-page">
    <header>
        <div class="header-content">
            <a href="index.html" class="logo">Mobil Maják</a>
            <nav>
                <ul>
                    <!-- Navigace bude vložena JavaScriptem -->
                </ul>
            </nav>
            <!-- Theme toggle a hamburger menu budou přidány navigation.js -->
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1>Bazar</h1>
                <p>Statistiky bazarových prodejů</p>
            </div>
        </section>

        <section>
            <div class="container">
                <!-- Tlačítko pro přidání nového bazaru -->
                <div style="text-align: center; margin: 2rem 0;">
                    <button id="newBazarBtn" class="btn btn-primary" style="margin-bottom: 2rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="16"></line>
                            <line x1="8" y1="12" x2="16" y2="12"></line>
                        </svg>
                        Nový Bazar
                    </button>
                </div>

                <!-- Formulář pro nový bazar (skrytý) -->
                <div id="newBazarForm" class="data-container" style="display: none; max-width: 800px; margin: 2rem auto;">
                    <div class="data-header">
                        <div class="data-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <path d="M9 9h6v6H9z"></path>
                            </svg>
                            Nový záznam do bazaru
                        </div>
                        <button id="closeFormBtn" style="background: none; border: none; color: var(--text-secondary); cursor: pointer;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    
                    <form id="bazarForm" style="padding: 2rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                            <!-- Základní informace -->
                            <div>
                                <label for="vykupka" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Výkupka *
                                </label>
                                <input type="text" id="vykupka" name="vykupka" required style="width: 100%;">
                            </div>
                            
                            <div>
                                <label for="typTelefonu" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Typ telefonu *
                                </label>
                                <input type="text" id="typTelefonu" name="typTelefonu" required style="width: 100%;">
                            </div>
                            
                            <div>
                                <label for="imei" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    IMEI *
                                </label>
                                <input type="text" id="imei" name="imei" required style="width: 100%;">
                            </div>
                            
                            <div>
                                <label for="jakSeONasDozvedelKlient" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Jak se o nás klient dozvěděl?
                                </label>
                                <select id="jakSeONasDozvedelKlient" name="jakSeONasDozvedelKlient" style="width: 100%;">
                                    <option value="">Vyberte...</option>
                                    <option value="internet">Internet</option>
                                    <option value="facebook">Facebook</option>
                                    <option value="google">Google</option>
                                    <option value="doporuceni">Doporučení</option>
                                    <option value="reklama">Reklama</option>
                                    <option value="prochazka">Procházka kolem</option>
                                    <option value="jine">Jiné</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="cena" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Cena (Kč) *
                                </label>
                                <input type="number" id="cena" name="cena" required style="width: 100%;" min="0" step="1">
                            </div>
                            
                            <!-- Příslušenství -->
                            <div>
                                <label for="nabijjecka" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Nabíječka
                                </label>
                                <select id="nabijjecka" name="nabijjecka" style="width: 100%;">
                                    <option value="ne">Ne</option>
                                    <option value="ano">Ano</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="krabicka" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Krabička
                                </label>
                                <select id="krabicka" name="krabicka" style="width: 100%;">
                                    <option value="ne">Ne</option>
                                    <option value="ano">Ano</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="zarucniList" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Záruční list
                                </label>
                                <select id="zarucniList" name="zarucniList" style="width: 100%;">
                                    <option value="ne">Ne</option>
                                    <option value="ano">Ano</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="zarukaDo" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Záruka do
                                    <small style="color: var(--text-secondary); font-weight: normal;">(DD.MM.YYYY nebo rolovátka)</small>
                                </label>
                                <div class="date-input-container">
                                    <div style="position: relative; width: 100%;">
                                        <input type="text" id="zarukaDo" name="zarukaDo" 
                                               style="width: 100%; padding-right: 45px;" 
                                               placeholder="např. 15.12.2025" 
                                               pattern="^([0-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.([0-9]{4})$"
                                               title="Zadejte datum ve formátu DD.MM.YYYY">
                                        <button type="button" class="date-toggle-btn" onclick="toggleDateInput('zarukaDo')" title="Přepnout na rolovátka">
                                            📅
                                        </button>
                                    </div>
                                    <div class="date-selects" id="zarukaDo_selects" style="display: none;">
                                        <select class="date-select day-select" data-field="zarukaDo">
                                            <option value="">Den</option>
                                        </select>
                                        <select class="date-select month-select" data-field="zarukaDo">
                                            <option value="">Měsíc</option>
                                            <option value="01">Leden</option>
                                            <option value="02">Únor</option>
                                            <option value="03">Březen</option>
                                            <option value="04">Duben</option>
                                            <option value="05">Květen</option>
                                            <option value="06">Červen</option>
                                            <option value="07">Červenec</option>
                                            <option value="08">Srpen</option>
                                            <option value="09">Září</option>
                                            <option value="10">Říjen</option>
                                            <option value="11">Listopad</option>
                                            <option value="12">Prosinec</option>
                                        </select>
                                        <select class="date-select year-select" data-field="zarukaDo">
                                            <option value="">Rok</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="pouziteDily" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Použité díly (Kč)
                                </label>
                                <input type="number" id="pouziteDily" name="pouziteDily" style="width: 100%;" min="0" step="1" value="0">
                            </div>
                            
                            <div>
                                <label for="vykoupil" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Vykoupil (příjmení) *
                                </label>
                                <input type="text" id="vykoupil" name="vykoupil" required style="width: 100%;">
                            </div>
                        </div>
                        
                        <!-- Informace o klientovi -->
                        <h3 style="color: var(--text-primary); margin: 2rem 0 1rem 0; font-size: 1.25rem;">Informace o klientovi</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                            <div>
                                <label for="jmenoKlienta" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Jméno klienta *
                                </label>
                                <input type="text" id="jmenoKlienta" name="jmenoKlienta" required style="width: 100%;">
                            </div>
                            
                            <div>
                                <label for="prijmeniKlienta" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Příjmení klienta *
                                </label>
                                <input type="text" id="prijmeniKlienta" name="prijmeniKlienta" required style="width: 100%;">
                            </div>
                            
                            <div style="grid-column: 1 / -1;">
                                <label for="adresaKlienta" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Adresa klienta *
                                </label>
                                <input type="text" id="adresaKlienta" name="adresaKlienta" required style="width: 100%;">
                            </div>
                            
                            <div>
                                <label for="rodneCislo" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Rodné číslo *
                                </label>
                                <input type="text" id="rodneCislo" name="rodneCislo" required style="width: 100%;" placeholder="000000/0000">
                            </div>
                            
                            <div>
                                <label for="rodinnyStav" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Rodinný stav
                                </label>
                                <select id="rodinnyStav" name="rodinnyStav" style="width: 100%;">
                                    <option value="">Vyberte...</option>
                                    <option value="svobodný/á">Svobodný/á</option>
                                    <option value="ženatý/vdaná">Ženatý/vdaná</option>
                                    <option value="rozvedený/á">Rozvedený/á</option>
                                    <option value="vdovec/vdova">Vdovec/vdova</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="mistoVydaniDokladu" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Místo vydání dokladu *
                                </label>
                                <input type="text" id="mistoVydaniDokladu" name="mistoVydaniDokladu" required style="width: 100%;">
                            </div>
                            
                            <div>
                                <label for="datumVydaniDokladu" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Datum vydání OP *
                                    <small style="color: var(--text-secondary); font-weight: normal;">(DD.MM.YYYY nebo rolovátka)</small>
                                </label>
                                <div class="date-input-container">
                                    <div style="position: relative; width: 100%;">
                                        <input type="text" id="datumVydaniDokladu" name="datumVydaniDokladu" required 
                                               style="width: 100%; padding-right: 45px;" 
                                               placeholder="např. 10.01.2020" 
                                               pattern="^([0-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.([0-9]{4})$"
                                               title="Zadejte datum ve formátu DD.MM.YYYY">
                                        <button type="button" class="date-toggle-btn" onclick="toggleDateInput('datumVydaniDokladu')" title="Přepnout na rolovátka">
                                            📅
                                        </button>
                                    </div>
                                    <div class="date-selects" id="datumVydaniDokladu_selects" style="display: none;">
                                        <select class="date-select day-select" data-field="datumVydaniDokladu">
                                            <option value="">Den</option>
                                        </select>
                                        <select class="date-select month-select" data-field="datumVydaniDokladu">
                                            <option value="">Měsíc</option>
                                            <option value="01">Leden</option>
                                            <option value="02">Únor</option>
                                            <option value="03">Březen</option>
                                            <option value="04">Duben</option>
                                            <option value="05">Květen</option>
                                            <option value="06">Červen</option>
                                            <option value="07">Červenec</option>
                                            <option value="08">Srpen</option>
                                            <option value="09">Září</option>
                                            <option value="10">Říjen</option>
                                            <option value="11">Listopad</option>
                                            <option value="12">Prosinec</option>
                                        </select>
                                        <select class="date-select year-select" data-field="datumVydaniDokladu">
                                            <option value="">Rok</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="platnostDo" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Platnost OP *
                                    <small style="color: var(--text-secondary); font-weight: normal;">(DD.MM.YYYY nebo rolovátka)</small>
                                </label>
                                <div class="date-input-container">
                                    <div style="position: relative; width: 100%;">
                                        <input type="text" id="platnostDo" name="platnostDo" required 
                                               style="width: 100%; padding-right: 45px;" 
                                               placeholder="např. 10.01.2030" 
                                               pattern="^([0-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.([0-9]{4})$"
                                               title="Zadejte datum ve formátu DD.MM.YYYY">
                                        <button type="button" class="date-toggle-btn" onclick="toggleDateInput('platnostDo')" title="Přepnout na rolovátka">
                                            📅
                                        </button>
                                    </div>
                                    <div class="date-selects" id="platnostDo_selects" style="display: none;">
                                        <select class="date-select day-select" data-field="platnostDo">
                                            <option value="">Den</option>
                                        </select>
                                        <select class="date-select month-select" data-field="platnostDo">
                                            <option value="">Měsíc</option>
                                            <option value="01">Leden</option>
                                            <option value="02">Únor</option>
                                            <option value="03">Březen</option>
                                            <option value="04">Duben</option>
                                            <option value="05">Květen</option>
                                            <option value="06">Červen</option>
                                            <option value="07">Červenec</option>
                                            <option value="08">Srpen</option>
                                            <option value="09">Září</option>
                                            <option value="10">Říjen</option>
                                            <option value="11">Listopad</option>
                                            <option value="12">Prosinec</option>
                                        </select>
                                        <select class="date-select year-select" data-field="platnostDo">
                                            <option value="">Rok</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="datumNarozeni" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Datum narození *
                                    <small style="color: var(--text-secondary); font-weight: normal;">(DD.MM.YYYY nebo rolovátka)</small>
                                </label>
                                <div class="date-input-container">
                                    <div style="position: relative; width: 100%;">
                                        <input type="text" id="datumNarozeni" name="datumNarozeni" required 
                                               style="width: 100%; padding-right: 45px;" 
                                               placeholder="např. 15.03.1990" 
                                               pattern="^([0-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.([0-9]{4})$"
                                               title="Zadejte datum ve formátu DD.MM.YYYY">
                                        <button type="button" class="date-toggle-btn" onclick="toggleDateInput('datumNarozeni')" title="Přepnout na rolovátka">
                                            📅
                                        </button>
                                    </div>
                                    <div class="date-selects" id="datumNarozeni_selects" style="display: none;">
                                        <select class="date-select day-select" data-field="datumNarozeni">
                                            <option value="">Den</option>
                                        </select>
                                        <select class="date-select month-select" data-field="datumNarozeni">
                                            <option value="">Měsíc</option>
                                            <option value="01">Leden</option>
                                            <option value="02">Únor</option>
                                            <option value="03">Březen</option>
                                            <option value="04">Duben</option>
                                            <option value="05">Květen</option>
                                            <option value="06">Červen</option>
                                            <option value="07">Červenec</option>
                                            <option value="08">Srpen</option>
                                            <option value="09">Září</option>
                                            <option value="10">Říjen</option>
                                            <option value="11">Listopad</option>
                                            <option value="12">Prosinec</option>
                                        </select>
                                        <select class="date-select year-select" data-field="datumNarozeni">
                                            <option value="">Rok</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="pohlavi" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Pohlaví *
                                </label>
                                <select id="pohlavi" name="pohlavi" required style="width: 100%;">
                                    <option value="">Vyberte...</option>
                                    <option value="muž">Muž</option>
                                    <option value="žena">Žena</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="cisloOP" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Číslo OP *
                                </label>
                                <input type="text" id="cisloOP" name="cisloOP" required style="width: 100%;" placeholder="123456789">
                            </div>
                            
                            <div>
                                <label for="mistoNarozeni" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Místo narození *
                                </label>
                                <input type="text" id="mistoNarozeni" name="mistoNarozeni" required style="width: 100%;">
                            </div>
                            
                            <div>
                                <label for="telefonniCislo" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Telefonní číslo
                                </label>
                                <input type="tel" id="telefonniCislo" name="telefonniCislo" style="width: 100%;" placeholder="+420 123 456 789">
                            </div>
                            
                            <div style="grid-column: 1 / -1;">
                                <label for="poznamky" style="display: block; font-weight: 500; color: var(--text-primary); margin-bottom: 0.5rem;">
                                    Poznámky
                                </label>
                                <textarea id="poznamky" name="poznamky" style="width: 100%; min-height: 80px; resize: vertical;" placeholder="Další poznámky k výkupu..."></textarea>
                            </div>
                        </div>
                        
                        <!-- Tlačítka -->
                        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
                            <button type="button" id="cancelFormBtn" style="background: var(--text-secondary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">
                                Zrušit
                            </button>
                            <button type="button" id="testFormBtn" style="background: #6366f1; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;" title="Vyplní testovací data a odešle formulář">
                                🧪 Test formuláře
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9,11 12,14 22,4"></polyline>
                                    <path d="M21,12v7a2,2 0,0 1,-2,2H5a2,2 0,0 1,-2,-2V5a2,2 0,0 1,2,-2h11"></path>
                                </svg>
                                Dokončit
                            </button>
                        </div>
                    </form>
                    
                    <div id="formMessage" class="message" style="display: none; margin: 1rem 2rem;"></div>
                </div>

                <div id="bazarDataContainer">
                    <!-- Bazarová data budou načtena zde -->
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Mobil Maják. Všechna práva vyhrazena.</p>
        </div>
    </footer>

    <div class="version-info">v2.3.0</div>

    <script src="access-control.js"></script>
    <script src="theme-toggle.js"></script>
    <script src="sales-assistant.js"></script>
    <script src="navigation.js?v=1.0.1"></script>
    <script src="image-upload.js"></script>
    <!-- AI chatbot skrytý -->
    <!-- <script src="ai-chatbot.js"></script> -->
    <script src="bazar-storage.js"></script>
    <script src="bazar-data-loader.js"></script>
    <script>
        // Inicializace bazarového data loaderu s lepším error handlingem
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Bazar.html inicializace dokončena');
            
            // Funkce pro inicializaci s retry logikou
            function initializeBazarLoader(attempt = 1) {
                console.log(`📊 Pokus o inicializaci #${attempt}`);
                console.log('🔐 Stav autentifikace:', document.body.classList.contains('authenticated'));
                console.log('📜 Všechny třídy body:', document.body.className);
                console.log('👤 Role uživatele:', localStorage.getItem('role'));
                console.log('🔑 Přihlášen:', localStorage.getItem('isLoggedIn'));
                
                try {
                    // Vždy spustíme inicializaci - access control se řeší v access-control.js
                    console.log('✅ Spouštím inicializaci bazarového loaderu...');
                    
                    // Kontrola existence kontejneru
                    const container = document.getElementById('bazarDataContainer');
                    if (!container) {
                        console.error('❌ Kontejner bazarDataContainer nenalezen!');
                        return;
                    }
                    
                    // Inicializace bazarového data loaderu
                    window.bazarLoader = new BazarDataLoader('bazarDataContainer');
                    console.log('📊 BazarDataLoader vytvořen');
                    
                    // Načtení dat
                    window.bazarLoader.loadBazarData();
                    console.log('📈 loadBazarData() spuštěno');
                    
                    // Inicializace formuláře pro nový bazar
                    initBazarForm();
                    console.log('📝 Formulář inicializován');
                    
                } catch (error) {
                    console.error('❌ Chyba při inicializaci:', error);
                    
                    // Retry pouze pokud jsme nezkusili víckrát než 3x
                    if (attempt < 3) {
                        console.log(`🔄 Opakuji za 1 sekundu (pokus ${attempt + 1}/3)`);
                        setTimeout(() => initializeBazarLoader(attempt + 1), 1000);
                    } else {
                        console.error('💀 Inicializace selhala po 3 pokusech');
                        
                        // Zobrazíme chybovou zprávu uživateli
                        const container = document.getElementById('bazarDataContainer');
                        if (container) {
                            container.innerHTML = `
                                <div style="
                                    padding: 2rem;
                                    text-align: center;
                                    background: var(--bg-secondary);
                                    border-radius: 8px;
                                    border: 1px solid var(--border-light);
                                    margin: 2rem 0;
                                ">
                                    <h3 style="color: var(--error); margin-bottom: 1rem;">⚠️ Chyba při načítání dat</h3>
                                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                        Nepodařilo se načíst bazarová data. Zkuste obnovit stránku.
                                    </p>
                                    <button onclick="window.location.reload()" style="
                                        background: var(--accent-blue);
                                        color: white;
                                        border: none;
                                        padding: 0.75rem 1.5rem;
                                        border-radius: 0.5rem;
                                        cursor: pointer;
                                        font-weight: 600;
                                    ">
                                        🔄 Obnovit stránku
                                    </button>
                                </div>
                            `;
                        }
                    }
                }
                
                // Theme manager
                try {
                    if (window.themeManager) {
                        window.themeManager.createThemeToggle();
                        console.log('🎨 Theme toggle buttons aktualizovány');
                    }
                } catch (error) {
                    console.warn('⚠️ Chyba při inicializaci theme manageru:', error);
                }
            }
            
            // Spustit inicializaci s malým zpožděním pro načtení všech skriptů
            setTimeout(initializeBazarLoader, 100);
        });
        
        // Funkce pro inicializaci formuláře
        function initBazarForm() {
            console.log('🔧 Inicializuji bazar formulář...');
            
            const newBazarBtn = document.getElementById('newBazarBtn');
            const newBazarForm = document.getElementById('newBazarForm');
            const closeFormBtn = document.getElementById('closeFormBtn');
            const cancelFormBtn = document.getElementById('cancelFormBtn');
            const bazarForm = document.getElementById('bazarForm');
            const formMessage = document.getElementById('formMessage');
            
            console.log('🔍 Kontrola elementů:', {
                newBazarBtn: !!newBazarBtn,
                newBazarForm: !!newBazarForm,
                closeFormBtn: !!closeFormBtn,
                cancelFormBtn: !!cancelFormBtn,
                bazarForm: !!bazarForm,
                formMessage: !!formMessage
            });
            
            if (!newBazarBtn) {
                console.error('❌ Tlačítko newBazarBtn nenalezeno!');
                console.log('🔍 Elementy v DOM:', document.querySelectorAll('[id*="azar"]'));
                
                // Zkusíme najít tlačítko později
                setTimeout(() => {
                    console.log('🔄 Opakuji hledání tlačítka...');
                    const retryBtn = document.getElementById('newBazarBtn');
                    if (retryBtn) {
                        console.log('✅ Tlačítko nalezeno při opakování!');
                        initBazarForm();
                    } else {
                        console.error('❌ Tlačítko stále nenalezeno');
                    }
                }, 1000);
                return;
            }
            
            if (!newBazarForm) {
                console.error('❌ Formulář newBazarForm nenalezen!');
                return;
            }
            
            // Kontrola CSS vlastností tlačítka
            const btnStyles = window.getComputedStyle(newBazarBtn);
            console.log('🎨 CSS vlastnosti tlačítka:', {
                display: btnStyles.display,
                visibility: btnStyles.visibility,
                opacity: btnStyles.opacity,
                pointerEvents: btnStyles.pointerEvents,
                position: btnStyles.position
            });
            
            // Zobrazení formuláře
            const clickHandler = function() {
                console.log('🔘 Kliknuto na tlačítko Nový bazar');
                newBazarForm.style.display = 'block';
                newBazarBtn.style.display = 'none';
                // Scroll k formuláři
                newBazarForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
            };
            
            // Přidání event listeneru s kontrolou
            try {
                newBazarBtn.addEventListener('click', clickHandler);
                console.log('✅ Event listener pro Nový bazar přidán');
                
                // Test funkčnosti tlačítka
                newBazarBtn.style.cursor = 'pointer';
                newBazarBtn.title = 'Klikněte pro otevření formuláře';
                
                // Přidání alternativního způsobu pro debug
                newBazarBtn.onclick = function(e) {
                    console.log('🔘 Onclick handler spuštěn');
                    clickHandler();
                };
                
            } catch (error) {
                console.error('❌ Chyba při přidávání event listeneru:', error);
            }
            
            // Skrytí formuláře
            function hideForm() {
                newBazarForm.style.display = 'none';
                newBazarBtn.style.display = 'block';
                bazarForm.reset();
                hideMessage();
            }
            
            closeFormBtn.addEventListener('click', hideForm);
            cancelFormBtn.addEventListener('click', hideForm);
            
            // Testovací tlačítko
            const testFormBtn = document.getElementById('testFormBtn');
            if (testFormBtn) {
                testFormBtn.addEventListener('click', function() {
                    console.log('🧪 Spouštím testovací vyplnění formuláře...');
                    fillTestData();
                    console.log('🧪 Testovací data vyplněna, odesílám formulář...');
                    // Simulovat odeslání formuláře
                    setTimeout(() => {
                        bazarForm.dispatchEvent(new Event('submit'));
                    }, 500);
                });
            }
            
            // Odeslání formuláře
            bazarForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validace formuláře
                const validationResult = validateForm();
                if (!validationResult.isValid) {
                    showErrorAnimation(validationResult.errors);
                    showMessage(validationResult.errors.join(', '), 'error');
                    return;
                }
                
                // Sběr dat z formuláře
                const formData = new FormData(bazarForm);
                const bazarData = {
                    datum: new Date().toISOString().split('T')[0], // Současné datum
                    cas: new Date().toLocaleTimeString('cs-CZ'),
                    vykupka: formData.get('vykupka'),
                    typTelefonu: formData.get('typTelefonu'),
                    imei: formData.get('imei'),
                    jakSeONasDozvedelKlient: formData.get('jakSeONasDozvedelKlient'),
                    cena: parseInt(formData.get('cena')),
                    nabijjecka: formData.get('nabijjecka'),
                    krabicka: formData.get('krabicka'),
                    zarucniList: formData.get('zarucniList'),
                    zarukaDo: convertDateFormat(formData.get('zarukaDo')),
                    pouziteDily: parseInt(formData.get('pouziteDily')) || 0,
                    vykoupil: formData.get('vykoupil'),
                    jmenoKlienta: formData.get('jmenoKlienta'),
                    prijmeniKlienta: formData.get('prijmeniKlienta'),
                    adresaKlienta: formData.get('adresaKlienta'),
                    rodneCislo: formData.get('rodneCislo'),
                    rodinnyStav: formData.get('rodinnyStav'),
                    mistoVydaniDokladu: formData.get('mistoVydaniDokladu'),
                    datumVydaniDokladu: convertDateFormat(formData.get('datumVydaniDokladu')),
                    platnostDo: convertDateFormat(formData.get('platnostDo')),
                    datumNarozeni: convertDateFormat(formData.get('datumNarozeni')),
                    pohlavi: formData.get('pohlavi'),
                    cisloOP: formData.get('cisloOP'),
                    mistoNarozeni: formData.get('mistoNarozeni'),
                    telefonniCislo: formData.get('telefonniCislo'),
                    poznamky: formData.get('poznamky')
                };
                
                // Uložení dat
                saveBazarData(bazarData);
            });
            
            // Zobrazení/skrytí zprávy
            function showMessage(text, type) {
                formMessage.textContent = text;
                formMessage.className = `message ${type}`;
                formMessage.style.display = 'block';
                formMessage.style.animation = 'fadeIn 0.3s ease-in-out';
            }
            
            function hideMessage() {
                formMessage.style.display = 'none';
                formMessage.style.animation = '';
            }
            
            // Konverze DD.MM.YYYY na YYYY-MM-DD nebo zachování prázdné hodnoty
            function convertDateFormat(dateString) {
                if (!dateString || dateString.trim() === '') {
                    return '';
                }
                
                const parts = dateString.split('.');
                if (parts.length === 3) {
                    const day = parts[0].padStart(2, '0');
                    const month = parts[1].padStart(2, '0');
                    const year = parts[2];
                    return `${year}-${month}-${day}`;
                }
                
                return dateString; // Vrátit původní pokud není ve správném formátu
            }
            
            // Funkce pro uložení dat do Google Sheets přes Google Apps Script
            async function saveBazarData(data) {
                const submitButton = document.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.innerHTML;
                
                try {
                    // Zobrazit loading stav
                    submitButton.disabled = true;
                    submitButton.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                            <path d="M21 12a9 9 0 11-6.219-8.56"/>
                        </svg>
                        Odesílám...
                    `;
                    
                    console.log('🚀 Odesílám data na Google Apps Script:', data);
                    
                    // Příprava dat pro Google Apps Script ve správném formátu
                    const payload = {
                        action: 'addRecord',
                        data: data
                    };
                    
                    console.log('📋 Payload pro odeslání:', payload);
                    
                    // Zkusíme první POST s JSON
                    console.log('🔄 Pokus #1: POST s JSON');
                    
                    let finalResponse;
                    
                    try {
                        // Pokus #1: POST s FormData (lépe funguje s Google Apps Script)
                        console.log('🔄 Pokus #1: POST s FormData');
                        
                        const formData = new FormData();
                        
                        // Přidání akce
                        formData.append('action', payload.action);
                        
                        // Přidání všech dat z formuláře
                        Object.keys(payload.data).forEach(key => {
                            const value = payload.data[key];
                            if (value !== null && value !== undefined && value !== '') {
                                formData.append(key, value.toString());
                            }
                        });
                        
                        console.log('📋 FormData obsahuje:', Array.from(formData.entries()).map(([k, v]) => `${k}: ${v}`));
                        
                        finalResponse = await fetch('https://script.google.com/macros/s/AKfycbyPrVbibH_2dCL-9MFRYkSURIV4_bQdruuX-BrGT00Z0kJTOP8cqs3kZ9SaOpXZ7qFA/exec', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!finalResponse.ok) throw new Error('POST FormData failed');
                        
                    } catch (error) {
                        console.log('❌ POST s FormData selhal, zkouším GET...');
                        
                        // Pokus #2: GET s parametry (fallback)
                        const params = new URLSearchParams();
                        
                        // Přidání akce
                        params.append('action', payload.action);
                        
                        // Přidání všech dat z formuláře
                        Object.keys(payload.data).forEach(key => {
                            const value = payload.data[key];
                            if (value !== null && value !== undefined && value !== '') {
                                params.append(key, value.toString());
                            }
                        });
                        
                        console.log('🔄 Pokus #2: GET s parametry');
                        console.log('📋 URL parametry:', params.toString());
                        
                        const url = `https://script.google.com/macros/s/AKfycbyPrVbibH_2dCL-9MFRYkSURIV4_bQdruuX-BrGT00Z0kJTOP8cqs3kZ9SaOpXZ7qFA/exec?${params.toString()}`;
                        
                        finalResponse = await fetch(url, {
                            method: 'GET'
                        });
                        
                        if (!finalResponse.ok) {
                            const errorText = await finalResponse.text();
                            console.error('❌ Všechny pokusy selhaly. Poslední chyba:', errorText);
                            throw new Error(`HTTP error! status: ${finalResponse.status} - ${errorText}`);
                        }
                    }
                    
                    console.log('📡 Response status:', finalResponse.status);
                    console.log('📡 Response headers:', finalResponse.headers);
                    
                    // Pokus o parsování JSON odpovědi
                    let result;
                    const responseText = await finalResponse.text();
                    console.log('📄 Raw response:', responseText.substring(0, 200) + '...');
                    
                    try {
                        result = JSON.parse(responseText);
                        console.log('📊 Parsed JSON response:', result);
                    } catch (parseError) {
                        console.error('❌ JSON Parse Error:', parseError);
                        console.log('📄 Full response text:', responseText);
                        
                        // Pokud response obsahuje "success", považuj to za úspěch
                        if (responseText.includes('success') || responseText.includes('úspěšně')) {
                            result = { success: true, message: 'Data byla úspěšně uložena' };
                        } else {
                            throw new Error(`Neplatná JSON odpověď: ${responseText.substring(0, 100)}`);
                        }
                    }
                    
                    if (result.success) {
                        // Úspěšné uložení - zobrazit veselý smajlík
                        showSuccessAnimation();
                        showMessage('😊 Úspěšně odesláno do Google Sheets!', 'success');
                        
                        // Přidání glow efektu k formuláři
                        newBazarForm.classList.add('form-success-glow');
                        
                        // Reset formuláře po 3 sekundách
                        setTimeout(() => {
                            hideForm();
                            newBazarForm.classList.remove('form-success-glow');
                            // Obnovení dat v tabulce
                            if (window.bazarLoader && window.bazarLoader.loadBazarData) {
                                window.bazarLoader.loadBazarData();
                            }
                        }, 3000);
                        
                        console.log('✅ Bazar záznam úspěšně uložen do Google Sheets');
                        
                    } else {
                        throw new Error(result.error || 'Neznámá chyba ze serveru');
                    }
                    
                } catch (error) {
                    console.error('❌ Chyba při odesílání na Google Apps Script:', error);
                    
                    let errorMessage = '😞 Nepodařilo se odeslat data';
                    let errorDetails = [];
                    
                    if (error.message.includes('Failed to fetch')) {
                        errorMessage = '🌐 Problém s připojením k internetu';
                        errorDetails = ['Zkontrolujte internetové připojení a zkuste to znovu'];
                    } else if (error.message.includes('HTTP error')) {
                        errorMessage = '⚠️ Chyba serveru';
                        errorDetails = ['Server je momentálně nedostupný, zkuste to později'];
                    } else if (error.message.includes('Neznámá chyba')) {
                        errorMessage = '🔧 Problém se zpracováním dat';
                        errorDetails = ['Zkontrolujte vyplněná data a zkuste to znovu'];
                    } else {
                        errorDetails = [error.message];
                    }
                    
                    // Zobrazit smutný smajlík a důvod chyby
                    showErrorAnimation(errorDetails);
                    showMessage(`${errorMessage}: ${errorDetails.join(', ')}`, 'error');
                    
                    // Přidání shake efektu k formuláři
                    newBazarForm.classList.add('form-error-shake');
                    setTimeout(() => {
                        newBazarForm.classList.remove('form-error-shake');
                    }, 3000);
                    
                } finally {
                    // Obnovit tlačítko
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                }
            }
            
            // Inicializace kalendářových inputů s lepším timingem
            setTimeout(() => {
                console.log('🔄 Spouštím inicializaci kalendářových rolovátka...');
                initializeDateInputs();
                
                // Přidej event listenery pro toggle tlačítka
                setupToggleButtons();
            }, 500);
        }
        
        // Funkce pro vyplnění testovacích dat
        function fillTestData() {
            console.log('🧪 Vyplňuji testovací data...');
            
            // Základní informace
            document.getElementById('vykupka').value = 'TEST001';
            document.getElementById('typTelefonu').value = 'iPhone 13 Pro';
            document.getElementById('imei').value = '123456789012345';
            document.getElementById('jakSeONasDozvedelKlient').value = 'internet';
            document.getElementById('cena').value = '15000';
            document.getElementById('nabijjecka').value = 'ano';
            document.getElementById('krabicka').value = 'ano';
            document.getElementById('zarucniList').value = 'ano';
            document.getElementById('zarukaDo').value = '15.12.2025';
            document.getElementById('pouziteDily').value = '0';
            document.getElementById('vykoupil').value = 'Novák';
            
            // Informace o klientovi
            document.getElementById('jmenoKlienta').value = 'Jan';
            document.getElementById('prijmeniKlienta').value = 'Testovací';
            document.getElementById('adresaKlienta').value = 'Testovací 123, Praha 1';
            document.getElementById('rodneCislo').value = '900101/1234';
            document.getElementById('rodinnyStav').value = 'svobodný/á';
            document.getElementById('mistoVydaniDokladu').value = 'Praha';
            document.getElementById('datumVydaniDokladu').value = '01.01.2020';
            document.getElementById('platnostDo').value = '01.01.2030';
            document.getElementById('datumNarozeni').value = '01.01.1990';
            document.getElementById('pohlavi').value = 'muž';
            document.getElementById('cisloOP').value = '123456789';
            document.getElementById('mistoNarozeni').value = 'Praha';
            document.getElementById('telefonniCislo').value = '+420 123 456 789';
            document.getElementById('poznamky').value = 'Testovací záznam pro kontrolu funkčnosti formuláře.';
            
            console.log('✅ Testovací data vyplněna');
        }
        
        // Inicializace date inputů s rolovátky
        function initializeDateInputs() {
            console.log('🗓️ Inicializuji date picker rolovátka...');
            const currentYear = new Date().getFullYear();
            
            // Najít všechny year selecty
            const yearSelects = document.querySelectorAll('.year-select');
            console.log(`Nalezeno ${yearSelects.length} year selectů`);
            
            // Inicializace všech year selectů
            yearSelects.forEach((select, index) => {
                // Vyčistit existující options (kromě první prázdné)
                while (select.children.length > 1) {
                    select.removeChild(select.lastChild);
                }
                
                // Přidání roků od současného roku do budoucna (10 let)
                for (let year = currentYear; year <= currentYear + 10; year++) {
                    const option = document.createElement('option');
                    option.value = year.toString();
                    option.textContent = year;
                    select.appendChild(option);
                }
                // Pak roky do minulosti
                for (let year = currentYear - 1; year >= 1920; year--) {
                    const option = document.createElement('option');
                    option.value = year.toString();
                    option.textContent = year;
                    select.appendChild(option);
                }
                
                console.log(`Year select ${index + 1} inicializován s ${select.children.length - 1} roky`);
            });
            
            // Najít všechny day selecty
            const daySelects = document.querySelectorAll('.day-select');
            console.log(`Nalezeno ${daySelects.length} day selectů`);
            
            // Inicializace dnů (1-31)
            daySelects.forEach((select, index) => {
                // Vyčistit existující options (kromě první prázdné)
                while (select.children.length > 1) {
                    select.removeChild(select.lastChild);
                }
                
                for (let day = 1; day <= 31; day++) {
                    const option = document.createElement('option');
                    option.value = day.toString().padStart(2, '0');
                    option.textContent = day;
                    select.appendChild(option);
                }
                
                console.log(`Day select ${index + 1} inicializován s ${select.children.length - 1} dny`);
            });
            
            // Event listenery pro synchronizaci selectů s text inputy
            const allDateSelects = document.querySelectorAll('.date-select');
            console.log(`Nalezeno ${allDateSelects.length} date selectů celkem`);
            
            allDateSelects.forEach((select, index) => {
                select.addEventListener('change', function() {
                    console.log(`Date select ${index + 1} změněn:`, this.dataset.field, '=', this.value);
                    updateDateInputFromSelects(this.dataset.field);
                });
            });
            
            console.log('✅ Date picker rolovátka inicializována');
        }
        
        // Nastavení toggle tlačítek pro kalendáře
        function setupToggleButtons() {
            console.log('🔘 Nastavuji toggle tlačítka...');
            
            const toggleButtons = document.querySelectorAll('.date-toggle-btn');
            console.log(`Nalezeno ${toggleButtons.length} toggle tlačítek`);
            
            toggleButtons.forEach((button, index) => {
                // Odebrat staré event listenery
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                
                // Najít fieldName z onclick atributu
                const onclickAttr = newButton.getAttribute('onclick');
                const fieldNameMatch = onclickAttr ? onclickAttr.match(/toggleDateInput\('([^']+)'\)/) : null;
                
                if (fieldNameMatch) {
                    const fieldName = fieldNameMatch[1];
                    console.log(`Toggle tlačítko ${index + 1} pro field: ${fieldName}`);
                    
                    newButton.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log(`🔘 Kliknuto na toggle pro: ${fieldName}`);
                        toggleDateInput(fieldName);
                    });
                } else {
                    console.log(`❌ Nepodařilo se najít fieldName pro toggle ${index + 1}`);
                }
            });
            
            console.log('✅ Toggle tlačítka nastavena');
        }
        
        // Přepínání mezi text inputem a rolovátky
        function toggleDateInput(fieldName) {
            const textInput = document.getElementById(fieldName);
            const selectsContainer = document.getElementById(fieldName + '_selects');
            const toggleBtn = textInput.parentNode.querySelector('.date-toggle-btn');
            const container = textInput.closest('.date-input-container');
            
            if (selectsContainer.style.display === 'none' || selectsContainer.style.display === '') {
                // Zobrazit rolovátka s animací
                selectsContainer.style.display = 'grid';
                selectsContainer.classList.add('show');
                toggleBtn.innerHTML = '📝'; // Změnit ikonu na tužku
                toggleBtn.title = 'Přepnout na textové pole';
                
                // Označit kontejner jako používající rolovátka
                container.classList.add('using-selects');
                
                // Synchronizovat hodnoty pokud je něco zadáno
                if (textInput.value) {
                    populateSelectsFromInput(fieldName, textInput.value);
                }
                
                // Disable text input při používání rolovátka
                textInput.readOnly = true;
                
                console.log('📅 Aktivována rolovátka pro:', fieldName);
            } else {
                // Skrýt rolovátka
                selectsContainer.style.display = 'none';
                selectsContainer.classList.remove('show');
                toggleBtn.innerHTML = '📅'; // Změnit ikonu zpět na kalendář
                toggleBtn.title = 'Přepnout na rolovátka';
                
                // Odebrat označení kontejneru
                container.classList.remove('using-selects');
                
                // Enable text input
                textInput.readOnly = false;
                
                console.log('📝 Aktivováno textové pole pro:', fieldName);
            }
        }
        
        // Naplnění selectů z text inputu
        function populateSelectsFromInput(fieldName, dateValue) {
            const parts = dateValue.split('.');
            if (parts.length === 3) {
                const daySelect = document.querySelector(`[data-field="${fieldName}"].day-select`);
                const monthSelect = document.querySelector(`[data-field="${fieldName}"].month-select`);
                const yearSelect = document.querySelector(`[data-field="${fieldName}"].year-select`);
                
                console.log(`🔄 Synchronizuji selecty pro ${fieldName}:`, parts);
                
                if (daySelect && parts[0]) {
                    daySelect.value = parts[0].padStart(2, '0');
                    console.log(`Day nastaven na: ${daySelect.value}`);
                }
                if (monthSelect && parts[1]) {
                    monthSelect.value = parts[1].padStart(2, '0');
                    console.log(`Month nastaven na: ${monthSelect.value}`);
                }
                if (yearSelect && parts[2]) {
                    yearSelect.value = parts[2];
                    console.log(`Year nastaven na: ${yearSelect.value}`);
                }
            }
        }
        
        // Aktualizace text inputu z selectů
        function updateDateInputFromSelects(fieldName) {
            const daySelect = document.querySelector(`[data-field="${fieldName}"].day-select`);
            const monthSelect = document.querySelector(`[data-field="${fieldName}"].month-select`);
            const yearSelect = document.querySelector(`[data-field="${fieldName}"].year-select`);
            const textInput = document.getElementById(fieldName);
            
            console.log(`🔄 Aktualizuji text input pro ${fieldName}`);
            console.log(`Day: ${daySelect?.value}, Month: ${monthSelect?.value}, Year: ${yearSelect?.value}`);
            
            if (daySelect && monthSelect && yearSelect && 
                daySelect.value && monthSelect.value && yearSelect.value) {
                
                const day = daySelect.value.padStart(2, '0');
                const month = monthSelect.value.padStart(2, '0');
                const year = yearSelect.value;
                
                const dateString = `${day}.${month}.${year}`;
                textInput.value = dateString;
                console.log(`📅 Datum aktualizováno na: ${dateString}`);
                validateDateInput(textInput);
            } else if (textInput && (!daySelect.value || !monthSelect.value || !yearSelect.value)) {
                // Pokud není všechno vyplněno, vymaž text input
                textInput.value = '';
                console.log(`📅 Text input vymazán pro ${fieldName}`);
            }
        }
        
        // Validace date inputu
        function validateDateInput(input) {
            const pattern = /^([0-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.([0-9]{4})$/;
            
            if (input.value && !pattern.test(input.value)) {
                input.style.borderColor = '#ef4444';
                input.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
            } else {
                input.style.borderColor = '';
                input.style.boxShadow = '';
            }
        }
        
        // Formátování date inputu
        function formatDateInput(input) {
            let value = input.value.replace(/[^\d]/g, '');
            
            // Omezit na maximum 8 číslic
            if (value.length > 8) {
                value = value.substring(0, 8);
            }
            
            // Formátování DD.MM.YYYY
            if (value.length >= 2) {
                value = value.substring(0, 2) + '.' + value.substring(2);
            }
            if (value.length >= 5) {
                value = value.substring(0, 5) + '.' + value.substring(5, 9);
            }
            
            input.value = value;
            
            // Validace pouze pokud je kompletní datum
            if (value.length === 10) {
                validateDateInput(input);
            }
        }
        
        // Validace celého formuláře
        function validateForm() {
            const errors = [];
            
            // Povinná pole
            const requiredFields = [
                { id: 'vykupka', name: 'Číslo výkupky' },
                { id: 'typTelefonu', name: 'Typ telefonu' },
                { id: 'imei', name: 'IMEI' },
                { id: 'cena', name: 'Cena' },
                { id: 'vykoupil', name: 'Kdo vykoupil' },
                { id: 'jmenoKlienta', name: 'Jméno klienta' },
                { id: 'prijmeniKlienta', name: 'Příjmení klienta' },
                { id: 'adresaKlienta', name: 'Adresa klienta' },
                { id: 'rodneCislo', name: 'Rodné číslo' },
                { id: 'mistoVydaniDokladu', name: 'Místo vydání dokladu' },
                { id: 'datumVydaniDokladu', name: 'Datum vydání dokladu' },
                { id: 'platnostDo', name: 'Platnost do' },
                { id: 'datumNarozeni', name: 'Datum narození' },
                { id: 'pohlavi', name: 'Pohlaví' },
                { id: 'cisloOP', name: 'Číslo OP' },
                { id: 'mistoNarozeni', name: 'Místo narození' }
            ];
            
            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element.value.trim()) {
                    errors.push(`${field.name} je povinné pole`);
                    element.style.borderColor = '#ef4444';
                    element.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                } else {
                    element.style.borderColor = '';
                    element.style.boxShadow = '';
                }
            });
            
            // Validace IMEI (pouze číslice, libovolný počet)
            const imei = document.getElementById('imei').value.trim();
            if (imei && !/^\d+$/.test(imei)) {
                errors.push('IMEI může obsahovat pouze číslice');
            }
            
            // Validace ceny (musí být číslo větší než 0)
            const cena = document.getElementById('cena').value.trim();
            if (cena && (isNaN(cena) || parseInt(cena) <= 0)) {
                errors.push('Cena musí být kladné číslo');
            }
            
            // Validace rodného čísla (základní kontrola - pouze číslice a případné lomítko)
            const rodneCislo = document.getElementById('rodneCislo').value.trim();
            if (rodneCislo && !/^[\d\/]+$/.test(rodneCislo)) {
                errors.push('Rodné číslo může obsahovat pouze číslice a lomítko');
            }
            
            // Validace telefonního čísla (pokud je vyplněno)
            const telefon = document.getElementById('telefonniCislo').value.trim();
            if (telefon && !/^(\+420)?\s?\d{3}\s?\d{3}\s?\d{3}$/.test(telefon)) {
                errors.push('Telefonní číslo musí být ve správném formátu');
            }
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }
        
        // Animace pro úspěch
        function showSuccessAnimation() {
            // Vytvoření konfet
            createConfetti();
            
            // Přidání emoji a textu
            const successEmoji = document.createElement('div');
            successEmoji.className = 'success-emoji';
            successEmoji.innerHTML = '😊';
            successEmoji.style.top = '25%';
            successEmoji.style.left = '50%';
            successEmoji.style.transform = 'translateX(-50%)';
            successEmoji.style.fontSize = '5rem';
            successEmoji.style.textAlign = 'center';
            document.body.appendChild(successEmoji);
            
            const celebrationText = document.createElement('div');
            celebrationText.className = 'celebration-text';
            celebrationText.innerHTML = '🎉 Úspěšně odesláno! 🎉';
            celebrationText.style.top = '40%';
            document.body.appendChild(celebrationText);
            
            // Přidání sparkle efektů
            createSparkles();
            
            // Odstranění po 4 sekundách
            setTimeout(() => {
                if (successEmoji.parentNode) successEmoji.remove();
                if (celebrationText.parentNode) celebrationText.remove();
            }, 4000);
        }
        
        // Animace pro chybu
        function showErrorAnimation(errors) {
            const errorEmoji = document.createElement('div');
            errorEmoji.className = 'error-emoji';
            errorEmoji.innerHTML = '😞';
            errorEmoji.style.top = '25%';
            errorEmoji.style.left = '50%';
            errorEmoji.style.transform = 'translateX(-50%)';
            errorEmoji.style.fontSize = '5rem';
            errorEmoji.style.textAlign = 'center';
            document.body.appendChild(errorEmoji);
            
            const errorText = document.createElement('div');
            errorText.className = 'error-text';
            errorText.innerHTML = '😞 Něco se nepovedlo';
            errorText.style.top = '40%';
            document.body.appendChild(errorText);
            
            // Přidání seznamu chyb pokud existují
            if (errors && errors.length > 0) {
                const errorDetails = document.createElement('div');
                errorDetails.style.position = 'fixed';
                errorDetails.style.top = '50%';
                errorDetails.style.left = '50%';
                errorDetails.style.transform = 'translateX(-50%)';
                errorDetails.style.fontSize = '1rem';
                errorDetails.style.color = '#dc2626';
                errorDetails.style.zIndex = '10000';
                errorDetails.style.textAlign = 'center';
                errorDetails.style.maxWidth = '80vw';
                errorDetails.style.padding = '10px';
                errorDetails.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
                errorDetails.style.borderRadius = '8px';
                errorDetails.innerHTML = errors.slice(0, 3).join('<br>'); // Max 3 chyby
                document.body.appendChild(errorDetails);
                
                setTimeout(() => {
                    if (errorDetails.parentNode) errorDetails.remove();
                }, 5000);
            }
            
            // Odstranění po 5 sekundách
            setTimeout(() => {
                if (errorEmoji.parentNode) errorEmoji.remove();
                if (errorText.parentNode) errorText.remove();
            }, 5000);
        }
        
        // Vytvoření konfet
        function createConfetti() {
            const animationOverlay = document.createElement('div');
            animationOverlay.className = 'animation-overlay';
            document.body.appendChild(animationOverlay);
            
            // Vytvoření 50 konfet
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                animationOverlay.appendChild(confetti);
            }
            
            // Odstranění overlay po 5 sekundách
            setTimeout(() => {
                animationOverlay.remove();
            }, 5000);
        }
        
        // Vytvoření sparkle efektů
        function createSparkles() {
            const sparkleContainer = document.createElement('div');
            sparkleContainer.style.position = 'fixed';
            sparkleContainer.style.top = '0';
            sparkleContainer.style.left = '0';
            sparkleContainer.style.width = '100vw';
            sparkleContainer.style.height = '100vh';
            sparkleContainer.style.pointerEvents = 'none';
            sparkleContainer.style.zIndex = '9998';
            document.body.appendChild(sparkleContainer);
            
            // Vytvoření 20 sparkles
            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.innerHTML = '✨';
                sparkle.style.left = Math.random() * 100 + 'vw';
                sparkle.style.top = Math.random() * 100 + 'vh';
                sparkle.style.animationDelay = Math.random() * 2 + 's';
                sparkleContainer.appendChild(sparkle);
            }
            
            // Odstranění po 3 sekundách
            setTimeout(() => {
                sparkleContainer.remove();
            }, 3000);
        }
        
        // Funkce pro skrytí obsahu podle role uživatele
        function setupRoleBasedAccess() {
            const userRole = localStorage.getItem('role');
            console.log('Kontrola role pro bazar:', userRole);
            
            if (userRole === 'Prodejce') {
                console.log('Uživatel je Prodejce - skrývám statistiky a zobrazuji pouze formulář');
                
                // Skrytí všech sekcí kromě formuláře
                const sectionsToHide = [
                    'hero', // hero sekce s nadpisem
                    'dataCont', // kontejner s daty
                    'retro' // retro tabulka
                ];
                
                sectionsToHide.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.display = 'none';
                    }
                });
                
                // Skrytí všech div elementů s tabulkami a statistikami
                document.querySelectorAll('.data-container:not(#newBazarForm)').forEach(container => {
                    container.style.display = 'none';
                });
                
                // Změna nadpisu stránky
                document.title = 'Přidat výkup - Mobil Maják';
                
                // Úprava hero sekce jen pro formulář
                const heroSection = document.querySelector('.hero');
                if (heroSection) {
                    heroSection.innerHTML = `
                        <div class="container">
                            <h1>Přidat nový výkup</h1>
                            <p>Formulář pro registraci výkupu mobilního telefonu</p>
                        </div>
                    `;
                    heroSection.style.display = 'block';
                }
                
                                 // Automatické otevření formuláře pro prodejce
                 setTimeout(() => {
                     const newBazarBtn = document.getElementById('newBazarBtn');
                     const newBazarForm = document.getElementById('newBazarForm');
                     
                     if (newBazarBtn && newBazarForm) {
                         newBazarForm.style.display = 'block';
                         newBazarBtn.style.display = 'none';
                         console.log('Formulář automaticky otevřen pro prodejce');
                         
                         // Scroll k formuláři
                         newBazarForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
                     }
                 }, 100);
                 
                 // Úprava close buttonu pro prodejce - přesměrování na prodejny
                 setTimeout(() => {
                     const closeBtn = document.getElementById('closeFormBtn');
                     if (closeBtn) {
                         closeBtn.addEventListener('click', function() {
                             window.location.href = 'prodejny.html';
                         });
                     }
                 }, 200);
            } else {
                console.log('Uživatel je Administrátor - zobrazuji plný obsah');
            }
        }
        
        // Volání při načtení stránky
        document.addEventListener('DOMContentLoaded', function() {
            setupRoleBasedAccess();
        });
    </script>
</body>
</html> 